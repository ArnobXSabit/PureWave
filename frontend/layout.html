<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PureWave</title>
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

<link href="https://cdn.jsdelivr.net/npm/heroicons@2.0.13/dist/heroicons.min.css" rel="stylesheet">

<link rel="icon" type="image/x-icon" href="favicon.png">

<style>
/* ---------- Global Styles ---------- */
* { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', Arial, sans-serif; }
body { background:#fff; color:#333; line-height:1.6; font-size:16px;}

/* ---------- Navbar ---------- */
.navbar{
  height: 60px;
  width: 96%;
  left: 2%;
  right: 2%;
  position: fixed;
  top: 0;
  z-index: 1000;
  background: #fff;
  box-shadow: 0 5px 8px rgba(114,114,114,0.1);
  display: flex;
  align-items: center;

  /* Rounded bottom corners */
  border-bottom-left-radius: 10px;   /* adjust size as needed */
  border-bottom-right-radius: 10px;
}

#navbarDropdownInput {
    height: 30px ; 
    width: 500px;
    max-width: 100%;
}

.duplicate-navbar {
  height: 100px;
  width: 100%;
  position: fixed;
  top: 0;
  z-index: 1000;
  background: #fff;
  box-shadow: 0 5px 8px rgba(0, 0, 0, 0.1);
  display: flex;
  align-items: center;
}

.nav-container {
  display: flex;
  justify-content: space-between;
  align-items: center; /* vertical center */
  margin: 0 auto;        /* cut space from left and right */
  width: 98%;
  padding: 0 16px;
  height: 100%;
  gap: 16px;
}

.nav-left {
  display: flex;
  align-items: center;
  gap: 12px; /* or whatever space you want */
}

/* brand logo */
.brand-icon {
  height: 20px;   
  width: auto;
  display: block;
}
.brand-icon-duplicate-navbar {
  height: 25px;   
  width: auto;
  display: block;
}

/* Nav links */
.nav-links {
  display: flex;
  align-items: center; /* vertical center */
  gap: 30px; /* or whatever space you want */
}

.nav-links a { color:#222; font-size:1.0rem; transition: color 0.3s; position:relative; }
.nav-links a:hover { color:#3a91f5; }

/* Duplicate Navbar */
.duplicate-navbar { z-index:1100; transition: transform 0.3s ease, opacity 0.3s ease; }
.duplicate-navbar.hidden { transform: translateY(-100%); opacity: 0; }

/* Adjust duplicate navbar height to 100px (top 30 + bottom 70) */
.duplicate-navbar {
  height: 120px;
  display: flex;
  flex-direction: column;
  z-index: 1100;
  transition: transform 0.3s ease, opacity 0.3s ease;
}

.duplicate-navbar .nav-container {
  width: 93%;  
  max-width: 100%;
  left: 2%;
  right: 5%; /* smaller right offset */
}

.duplicate-navbar .nav-container {
  display: flex;
  justify-content: flex-start; /* or space-around / gap */
  gap: 125px; /* distance between search & cart */
}

.duplicate-navbar .nav-links a i {
  font-size: 1.2rem; /* increase size (default is ~1rem) */
  color: #3e3e3e;    /* optional: change color */
  transition: color 0.3s;
}

/* Hover color */
.duplicate-navbar .nav-links a:hover i {
  color: #3a91f5;     /* color on hover */
}

.duplicate-navbar .nav-cart-count {
  width: 15px;       /* bigger badge */
  height: 15px;
  font-size: 0.85rem;
  top: -0px;        /* adjust vertical */
  right: -15px;      /* adjust horizontal */
}

/* Optional: adjust spacing between search and icons */
.duplicate-navbar .nav-container {
  gap: 120px;  /* decrease space between center search and nav-links */
}

/* promo bar full control here */

.top-bar {
  display: flex;
  width: 100%;
  height: 50px;
  background-color: #f0f2f5 ; 
}

/* Each section */
.top-bar-section {
  flex: 1; /* equal width by default */
  display: flex;
  align-items: center;
  justify-content: center; /* default center */
  transition: all 0.3s;
}

/* Individual control */

/* Promo 1 */
.promo1 {
  flex: 0 0 25% ; 
  background-color: #000000;
  padding: 0 8px;
}
.promo1 .top-item {
  font-weight: 700;      /* bold */
  color:white ; 
  text-decoration: none; /* no underline */
  font-size: .88rem;    /* smaller */
}

.thunder-icon {
  color: #e7ad5c;       /* gold/yellow */
  margin-right: 3px;    /* space between icon and text */
  font-size: 1.3rem;    /* adjust size */
  vertical-align: middle;
}

/* Promo 2 */
.promo2 {
  flex: 0 0 25.5% ; 
  padding: 0 12px;
}

/* Promo 3 */
.promo3 {
  flex: 0 0 17% ; 
  background-color: #000000;
  padding: 0 6px;
}
.promo3 .top-item {
  font-weight: 400;      /* bold */
  color:white ; 
  text-decoration: none; /* no underline */
  font-size: 0.80rem;    /* smaller */
}
.promo3 .fa-truck {
  transform: scaleY(-1); /* flips the truck horizontally */
  transform: scaleX(-1);
}

/* Promo 4 */
.promo4 { 
  flex: 0 0 0.5% ; 
  padding: 0 10px; 
}

/* Promo 5 */
.promo5 { 
  flex: 0 0 15% ; 
  background-color: #000000;
  padding: 0 12px; }
.promo5 .top-item {
  font-weight: 400;      /* bold */
  color:white ; 
  text-decoration: none; /* no underline */
  font-size: 0.80rem;    /* smaller */
}

.promo6 .top-item {
  font-weight: 500;      /* bold */
  color:rgb(87, 87, 87) ; 
  text-decoration: none; /* no underline */
  font-size: 0.90rem;    /* smaller */
}

.promo7 .top-item {
  font-weight: 500;      /* bold */
  color:#3a91f5; 
  text-decoration: none; /* no underline */
  font-size: 0.90rem;    /* smaller */
}

.top-bar-section a {
  display: flex;             /* keeps icon + text inline */
  align-items: center;       /* vertical center */
  justify-content: center;   /* or flex-start if you prefer left alignment */
  width: 100%;
  height: 100%;
  text-decoration: none;
  color: inherit;
}

/* ---------- Cart ---------- */
.nav-cart-count {position: absolute;top: -8px;right: -8px;background: #3a91f5;color: #fff;font-size: 0.75rem;font-weight: bold;width: 18px;height: 18px;border-radius: 50%;display: flex;justify-content: center;align-items: center;}
/* Floating Rectangle Cart */
#floatingCart {
  position: fixed;
  top: 50%;                /* place at the middle vertically */
  right: -0.5%;             /* stick to the right edge */
  transform: translateY(-50%); /* center it perfectly */
  
  width: 50px;
  height: 40px;
  background: #3a91f5;
  color: #fff;
  border-radius: 8px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 1.2rem;
  z-index: 1200;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
}

/* Red bubble on top-right corner of the cart */
#floatingCart span {
  position: absolute;
  top: -5px;
  right: 35px;
  width: 20px;
  height: 20px;
  background: #ff0000;
  color: #fff;
  font-size: 0.75rem;
  font-weight: bold;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
}


/* Center search bar */
/* Boxy Modern Search Bar */
.nav-center {
  position: relative;
  max-width: 800px;
  width: 100%;
}

.nav-center input[type="text"] {
  width: 100%;
  padding: 10px 36px 10px 12px; /* space for search icon on right */
  border: 1px solid #ccc;       /* subtle border */
  font-size: 0.95rem;
  outline: none;
  transition: border 0.3s, box-shadow 0.3s;
}

.nav-center input[type="text"]:focus {
  border-color: #3a91f5;
}

/* Search icon inside input */
.nav-center button {
  position: absolute;
  top: 50%;
  right: 8px;
  transform: translateY(-50%);
  background: transparent;
  border: none;
  cursor: pointer;
  font-size: 1rem;
  color: #555;
  padding: 0;
}
.nav-center button:hover {
  color: #3a91f5;
}


/* Autocomplete dropdown */
.autocomplete-items {
  position: absolute;
  top: 100%;
  left: 0;
  width: 100%;
  background: #fff;
  border: 1px solid #ccc;
  border-radius: 8px;
  max-height: 250px;
  overflow-y: auto;
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  z-index: 9999;
  padding: 4px 0;
  margin-top: 4px;
}
.autocomplete-items div {
  padding: 10px 16px;
  cursor: pointer;
  font-size: 0.95rem;
  color: #333;
  transition: background 0.2s, color 0.2s;
}
.autocomplete-items div:hover,
.autocomplete-active {
  background: #3a91f5;
  color: #fff;
  border-radius: 6px;
}

/* ---------- Responsive ---------- */
@media (max-width: 768px) { 
  .nav-links { gap: 16px; font-size: 1.2rem; }
  .nav-center input[type="text"] { max-width: 90vw; }
  #navbarSearchDropdown { width: 90vw !important; left: 5vw; }
}

.hamburger {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  width: 20px;
  height: 15px;
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 0;
}

.hamburger span {
  display: block;
  height: 3px;
  width: 100%;
  background: #222;
  border-radius: 2px;
  transition: all 0.3s ease;
}

/* Optional: animate hamburger into X when active */
.hamburger.active span:nth-child(1) { transform: rotate(45deg) translate(5px, 5px); }
.hamburger.active span:nth-child(2) { opacity: 0; }
.hamburger.active span:nth-child(3) { transform: rotate(-45deg) translate(5px, -5px); }

/* ---------- Sidebar ---------- */
#sidebar { position: fixed; left: -300px; width: 300px; height: calc(100% - 100px); background:#fafafa; color:#1a1a1a; overflow-y:auto; box-shadow:3px 0 12px rgba(0,0,0,0.1); padding:20px; transition:left 0.3s ease; z-index:1200; }
#sidebar.open { left:0; }
#sidebar::-webkit-scrollbar { width:8px; }
#sidebar::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.25); border-radius:4px; }
#sidebar h2 { margin-top:0; margin-bottom:12px; font-size:1.3rem; font-weight:700; }
#sidebar ul { list-style:none; padding-left:0; margin:0; }
#sidebar ul li { margin:6px 0; }
#sidebar ul li .flex-row { display:flex; justify-content:space-between; align-items:center; }
#sidebar ul li a { text-decoration:none; color:#222; font-weight:600; transition:color 0.2s ease; }
#sidebar ul li a:hover { color:#3a91f5; }
#sidebar ul li span.toggle { cursor:pointer; font-weight:900; font-size:1.5rem; color:#000; margin-left:8px; user-select:none; }
#sidebar ul li a.grand { font-weight:700; font-size:1.1rem; }
#sidebar ul li a.parent { font-weight:600; font-size:1rem; }
#sidebar ul li a.child { font-weight:500; font-size:0.95rem; }

/* ---------- Footer ---------- */
footer { background:#222; color:#fff; padding:40px 0; text-align:center; font-size:0.9rem; }

@media (max-width: 500px) { #sidebar { width: 80vw; } }

/* Floating background & icons */
#floatingBackground {
  position: fixed;
  top: 100px;
  left: 0;
  width: 100%;
  height: calc(100% - 100px);
  pointer-events: none;
  overflow: hidden;
  z-index: 1;
}
.floating-icon {
  position: absolute;
  width: 60px;
  height: 60px;
  opacity: 0.1;
  animation: float 12s ease-in-out infinite;
}
@keyframes float {
  0%   { transform: translateY(0) translateX(0) rotate(0deg); }
  25%  { transform: translateY(-20px) translateX(10px) rotate(10deg); }
  50%  { transform: translateY(20px) translateX(-10px) rotate(-10deg); }
  75%  { transform: translateY(-10px) translateX(5px) rotate(5deg); }
  100% { transform: translateY(0) translateX(0) rotate(0deg); }
}

/* Accessibility */
#sidebarToggle{ aria-label: "Toggle Sidebar Menu"; }
</style>
</head>
<body>

<!-- Duplicate Navbar -->
<header class="duplicate-navbar" id="duplicateNavbar">

<!-- Top Promo Bar -->
<div class="top-bar">
  <div class="top-bar-section promo1"><a href="sale.html" class="top-item">
    <i class="fas fa-bolt thunder-icon"></i>
  EXCLUSIVE T-SHIRTS ON SALE | Limited Time Only
  <span class="arrow-circle"><i class="fas fa-arrow-right"></i></span>
</a>
</div>
  <div class="top-bar-section promo2"><a href="#" class="top-item"></a></div>
  <div class="top-bar-section promo3"><a href="bulk.html" class="top-item"><i class="fas fa-truck"></i> Order Bulk / Corporate Sale</a></div>
  <div class="top-bar-section promo4"><a href="#" class="top-item"></a></div>
  <div class="top-bar-section promo5"><a href="locations.html" class="top-item"><i class="fas fa-location-dot"></i> Store Location</a></div>
  <div class="top-bar-section promo6"><a href="about.html" class="top-item"><i class="fas fa-circle-question"></i> About Us</a></div>
  <div class="top-bar-section promo7">
    <a href="login.html" class="top-item" id="loginLink">
      <i class="fas fa-right-to-bracket" style="margin-right:4px;"></i> Login
    </a>
  </div>
</div>

  <!-- Bottom Navbar (Existing Duplicate Navbar Content) -->
  <div class="nav-container">
    <div class="nav-left">
      <a href="index.html" class="brand" style="display:flex;align-items:center;gap:8px;">
        <img src="home.svg" alt="PureWave Logo" class="brand-icon-duplicate-navbar">
      </a>
    </div>
    <div>
          <nav class="nav-links">
      <a href="products.html" title="Shop"><i class="fas fa-store"></i></a>
      </nav>
    </div>
      <div class="nav-center">
        <form id="searchForm" style="position: relative; width: 100%;">
          <input type="text" id="searchInput" placeholder="Search products...">
          <button type="submit"><i class="fas fa-search"></i></button>
        </form>
      </div>
    <nav class="nav-links">
        <a href="cart.html" title="Cart">
          <i class="fas fa-shopping-cart"></i>
          <span class="nav-cart-count" id="duplicateNavbarCartCount">0</span>
        </a>
    </nav>
  </div>
</header>

<!-- Original Navbar -->
<header class="navbar" id="navbar">
  <div class="nav-container">
    <div class="nav-left">
      <button id="sidebarToggle" class="hamburger" aria-label="Toggle Sidebar">
        <span></span>
        <span></span>
        <span></span>
      </button>
        <a href="index.html" class="brand" style="display:flex;align-items:center;gap:8px;">
          <img src="home.svg" alt="PureWave Logo" class="brand-icon">
        </a>
    </div>
    <nav class="nav-links">
      <a href="index.html" title="Home"><i class="fas fa-home"></i></a>
      <a href="javascript:void(0);" id="navbarSearchIcon" title="Search"><i class="fas fa-search"></i></a>
      <a href="products.html" title="Shop"><i class="fas fa-store"></i></a>
      <a href="cart.html" title="Cart">
        <i class="fas fa-shopping-cart"></i>
        <span class="nav-cart-count" id="navbarCartCount">0</span>
      </a>
      <a href="userprofile.html" title="Profile"><i class="fas fa-user"></i></a>
    </nav>
    <div id="navbarSearchDropdown">
      <div class="nav-center">
        <form id="navbarDropdownForm">
          <input type="text" id="navbarDropdownInput" placeholder="Search products...">
          <button type="submit"><i class="fas fa-search"></i></button>
        </form>
      </div>
    </div>
  </div>
</header>

<!-- Floating Background -->
<div id="floatingBackground"></div>

<main>
  <h1>testing layout</h1>
  <h2>testing layout</h2>
  <h3>testing layout</h3>
  <h4>testing layout</h4>
  <h5>testing layout</h5>
  <h6>testing layout</h6>

  <h1>testing layout</h1>
  <h2>testing layout</h2>
  <h3>testing layout</h3>
  <h4>testing layout</h4>
  <h5>testing layout</h5>
  <h6>testing layout</h6>

  <h1>testing layout</h1>
  <h2>testing layout</h2>
  <h3>testing layout</h3>
  <h4>testing layout</h4>
  <h5>testing layout</h5>
  <h6>testing layout</h6>

  <h1>testing layout</h1>
  <h2>testing layout</h2>
  <h3>testing layout</h3>
  <h4>testing layout</h4>
  <h5>testing layout</h5>
  <h6>testing layout</h6>

  <h1>testing layout</h1>
  <h2>testing layout</h2>
  <h3>testing layout</h3>
  <h4>testing layout</h4>
  <h5>testing layout</h5>
  <h6>testing layout</h6>

    <h1>testing layout</h1>
  <h2>testing layout</h2>
  <h3>testing layout</h3>
  <h4>testing layout</h4>
  <h5>testing layout</h5>
  <h6>testing layout</h6>

  <h1>testing layout</h1>
  <h2>testing layout</h2>
  <h3>testing layout</h3>
  <h4>testing layout</h4>
  <h5>testing layout</h5>
  <h6>testing layout</h6>

  <h1>testing layout</h1>
  <h2>testing layout</h2>
  <h3>testing layout</h3>
  <h4>testing layout</h4>
  <h5>testing layout</h5>
  <h6>testing layout</h6>

  <h1>testing layout</h1>
  <h2>testing layout</h2>
  <h3>testing layout</h3>
  <h4>testing layout</h4>
  <h5>testing layout</h5>
  <h6>testing layout</h6>

  <h1>testing layout</h1>
  <h2>testing layout</h2>
  <h3>testing layout</h3>
  <h4>testing layout</h4>
  <h5>testing layout</h5>
  <h6>testing layout</h6>
</main>

<footer>
  &copy; 2025 PureWave. All rights reserved.
</footer>

<aside id="sidebar">
  <h2>Categories</h2>
  <ul id="sidebarCategories"></ul>
</aside>

<!-- Floating Cart -->
<a href="cart.html" id="floatingCart">
  <i class="fas fa-shopping-cart"></i>
  <span id="cartCount">0</span>
</a>

<script>
// ---------- Backend & Categories ----------
const BACKEND_URL = "https://purewave.onrender.com";
let allCategories = [];

async function loadAllCategories() {
  try { const res = await fetch(`${BACKEND_URL}/api/categories`); allCategories = await res.json(); }
  catch(err) { console.error(err); }
}

async function loadSidebarCategories() {
  try {
    const res = await fetch(`${BACKEND_URL}/api/categories`);
    const categories = await res.json();
    const container = document.getElementById("sidebarCategories");
    const map = {};
    categories.forEach(cat => { const pid = cat.parent_id ?? 0; if(!map[pid]) map[pid]=[]; map[pid].push(cat); });
    function createList(pid, depth=0) {
      if(!map[pid]) return null;
      const ul = document.createElement('ul'); ul.style.paddingLeft = depth?'14px':'0';
      map[pid].forEach(cat=>{
        const li=document.createElement('li');
        const hasChildren = map[cat.category_id] && map[cat.category_id].length>0;
        const flex=document.createElement('div'); flex.className='flex-row';
        const a=document.createElement('a'); a.textContent=cat.category_name;
        a.href = hasChildren ? '#' : `products.html?category=${cat.category_id}`;
        a.className = depth===0?'grand':depth===1?'parent':'child';
        flex.appendChild(a);
        const childrenUl=createList(cat.category_id,depth+1);
        if(childrenUl){
          childrenUl.style.display='none';
          const toggle=document.createElement('span'); toggle.textContent='+'; toggle.className='toggle';
          toggle.addEventListener('click', e=>{e.stopPropagation(); childrenUl.style.display=childrenUl.style.display==='block'?'none':'block'; toggle.textContent=childrenUl.style.display==='block'?'−':'+';});
          a.addEventListener('click', e=>{if(hasChildren){e.preventDefault(); toggle.click();}});
          flex.appendChild(toggle); li.appendChild(flex); li.appendChild(childrenUl);
        } else li.appendChild(flex);
        ul.appendChild(li);
      });
      return ul;
    }
    const topUl=createList(0); if(topUl) container.appendChild(topUl);
  } catch(err){ console.error(err); }
}

const sidebarToggle = document.getElementById('sidebarToggle');
const sidebar = document.getElementById('sidebar');

// Toggle sidebar on hamburger click
sidebarToggle.addEventListener('click', (e) => {
  e.stopPropagation(); // prevent document click
  sidebar.classList.toggle('open');
  sidebarToggle.classList.toggle('active'); // animate hamburger
});

// Close sidebar when clicking outside
document.addEventListener('click', (e) => {
  if (!sidebar.contains(e.target)) {
    sidebar.classList.remove('open');
    sidebarToggle.classList.remove('active'); // reset hamburger animation
  }
});

// Optional: adjust sidebar height on load/resize
function adjustSidebar() {
  const navHeight = document.querySelector('.navbar').offsetHeight;
  sidebar.style.top = navHeight + 'px';
  sidebar.style.height = `calc(100% - ${navHeight}px)`;
}
window.addEventListener('load', adjustSidebar);
window.addEventListener('resize', adjustSidebar);

let wasDuplicateNavbarHidden = false; // track previous state

window.addEventListener('scroll', () => {
  const scrollY = window.scrollY;
  const isHidden = scrollY > hideThreshold;

  duplicateNavbar.classList.toggle('hidden', isHidden);
  mainContent.style.paddingTop = isHidden ? originalNavbarHeight + 'px' : duplicateNavbarHeight + 'px';

  // Only close sidebar when duplicate navbar becomes visible
  if (wasDuplicateNavbarHidden && !isHidden) {
    sidebar.classList.remove('open');
    sidebarToggle.classList.remove('active');
  }

  wasDuplicateNavbarHidden = isHidden;
});

// ---------- cart logic ------------
let guestId = localStorage.getItem('guest_id');
if(!guestId){
    guestId = 'guest_' + Date.now() + '_' + Math.floor(Math.random()*10000);
    localStorage.setItem('guest_id', guestId);
}

async function addToCart(productId, quantity){
    const user = JSON.parse(localStorage.getItem('user')) || null;
    const payload = {
        product_id: productId,
        quantity: quantity
    };

    if(user) payload.user_id = user.user_id;      // logged-in user
    else payload.guest_id = localStorage.getItem('guest_id'); // guest

    const res = await fetch(`${BACKEND_URL}/api/cart`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
    });
    const data = await res.json();
    updateCartCount(); // refresh cart count
}

async function fetchCart(){
    const user = JSON.parse(localStorage.getItem('user')) || null;
    let url = `${BACKEND_URL}/api/cart`;

    if(user) url += `?user_id=${user.user_id}`;
    else url += `?guest_id=${localStorage.getItem('guest_id')}`;

    const res = await fetch(url);
    const cartItems = await res.json();
    return cartItems;
}

// ---------- Cart count ----------
async function updateCartCount(){
    const cartItems = await fetchCart();
    const count = cartItems.reduce((sum, item)=> sum + item.quantity, 0);
    document.getElementById('cartCount').textContent = count;
    document.getElementById('navbarCartCount').textContent = count;
    document.getElementById('duplicateNavbarCartCount').textContent = count;
}


// ---------- Duplicate navbar scroll & content adjust ----------
const duplicateNavbar = document.getElementById('duplicateNavbar');
const mainContent = document.querySelector('main');
const hideThreshold = 1;

// Heights
const originalNavbarHeight = document.getElementById('navbar').offsetHeight; // 70px or your navbar height
const duplicateNavbarHeight = duplicateNavbar.offsetHeight; // 120px

// Add smooth transition for padding
mainContent.style.transition = 'padding-top 0.1s ease';

window.addEventListener('scroll', () => {
  const scrollY = window.scrollY;

  if (scrollY > hideThreshold) {
    // Hide duplicate navbar
    duplicateNavbar.classList.add('hidden');
    // Main content padding = original navbar only
    mainContent.style.paddingTop = originalNavbarHeight + 'px';
  } else {
    // Show duplicate navbar
    duplicateNavbar.classList.remove('hidden');
    // Main content padding = original + duplicate navbar
    mainContent.style.paddingTop = ( duplicateNavbarHeight) + 'px';
  }
})

// Initialize padding on page load
mainContent.style.paddingTop = (duplicateNavbarHeight) + 'px';


// ---------- Autocomplete ----------
function setupAutocomplete(input){
  let currentFocus=-1; let list;
  input.addEventListener('input', function(){
    closeList(); if(!this.value) return;
    const val=this.value.toLowerCase();
    const matches=allCategories.filter(c=>c.category_name.toLowerCase().includes(val));
    if(!matches.length) return;
    list=document.createElement('div'); list.className='autocomplete-items';
    list.style.width = input.offsetWidth + 'px';
    matches.forEach(cat=>{
      const item=document.createElement('div'); item.textContent=cat.category_name;
      item.addEventListener('click', ()=>{window.location.href=`products.html?category=${cat.category_id}`;});
      list.appendChild(item);
    });
    input.parentNode.appendChild(list);
  });
  input.addEventListener('keydown', function(e){
    if(!list) return;
    const items=list.getElementsByTagName('div');
    if(e.key==='ArrowDown'){ currentFocus++; addActive(items); }
    else if(e.key==='ArrowUp'){ currentFocus--; addActive(items); }
    else if(e.key==='Enter'){ e.preventDefault(); if(currentFocus>-1) items[currentFocus].click(); }
    else if(e.key==='Escape'){ closeList(); }
    function addActive(items){ removeActive(items); if(currentFocus>=items.length) currentFocus=0; if(currentFocus<0) currentFocus=items.length-1; items[currentFocus].classList.add('autocomplete-active'); }
    function removeActive(items){ for(let i=0;i<items.length;i++) items[i].classList.remove('autocomplete-active'); }
  });
  document.addEventListener('click', function(e){ if(e.target!==input) closeList(); });
  function closeList(){ if(list) list.remove(); currentFocus=-1; }
}

// ---------- Search forms ----------
function setupSearchForm(form,input){ form.addEventListener('submit', e=>{ e.preventDefault(); const q=input.value.trim(); if(q) window.location.href=`products.html?search=${encodeURIComponent(q)}`; }); }

// ---------- Floating Icons ----------
const floatingBg = document.getElementById('floatingBackground');
let ICON_COUNT = window.innerWidth < 768 ? 50 : 200;
const ICON_SIZE = 60;
const icons = [];

function isOverlapping(x, y, existingIcons) {
  for (let icon of existingIcons) {
    const dx = x - icon.dataset.x;
    const dy = y - icon.dataset.y;
    const distance = Math.sqrt(dx*dx + dy*dy);
    if (distance < ICON_SIZE + 10) return true;
  }
  return false;
}

function createFloatingIcons() {
  floatingBg.innerHTML = '';
  icons.length = 0;
  const vw = window.innerWidth;
  const vh = window.innerHeight - 100;
  for (let i = 0; i < ICON_COUNT; i++) {
    const icon = document.createElement('img');
    icon.src = 'w-icon.svg';
    icon.className = 'floating-icon';
    let x, y, attempts = 0;
    do { 
      x = Math.random() * (vw - ICON_SIZE); 
      y = Math.random() * (vh - ICON_SIZE); 
      attempts++; 
      if (attempts > 100) break; 
    } while (isOverlapping(x, y, icons));
    icon.dataset.x = x; 
    icon.dataset.y = y;
    icon.style.left = x + 'px'; 
    icon.style.top = y + 'px';
    floatingBg.appendChild(icon); 
    icons.push(icon);
  }
}

let ticking = true;
function updateIconsOnScroll() {
  if (!ticking) {
    window.requestAnimationFrame(() => {
      const scrollY = window.scrollY;
      const vh = window.innerHeight - 100;
      icons.forEach(icon => {
        let y = parseFloat(icon.dataset.y) - scrollY * 0.2;
        if (y < -ICON_SIZE) {
          y = vh + Math.random() * 100;
          icon.dataset.x = Math.random() * (window.innerWidth - ICON_SIZE);
          icon.dataset.y = y;
          icon.style.left = icon.dataset.x + 'px';
        }
        icon.style.transform = `translateY(${y}px)`;
      });
      ticking = false;
    });
    ticking = true;
  }
}

function handleResize() {
  ICON_COUNT = window.innerWidth < 768 ? 50 : 200;
  createFloatingIcons();
  updateIconsOnScroll();
}

// ---------- Initialize ----------
document.addEventListener('DOMContentLoaded', async ()=>{
  await loadAllCategories();
  loadSidebarCategories();
  setupAutocomplete(document.getElementById('searchInput'));
  setupAutocomplete(document.getElementById('navbarDropdownInput')); // fixed typo
  setupSearchForm(document.getElementById('searchForm'), document.getElementById('searchInput'));
  setupSearchForm(document.getElementById('navbarDropdownForm'), document.getElementById('navbarDropdownInput'));
  updateCartCount();
  createFloatingIcons();

  // ---------- Login/Dashboard switch ----------
const loginLink = document.getElementById('loginLink');

// Example: check login status from localStorage (or your backend)
const userData = localStorage.getItem('user'); // assuming you store user info in localStorage after login

if (userData) {
  // If logged in
  loginLink.innerHTML = `<i class="fas fa-gauge" style="margin-right:4px;"></i> Dashboard`;
  loginLink.href = "userProfile.html"; // or your actual dashboard page
} else {
  // If not logged in
  loginLink.innerHTML = `<i class="fas fa-right-to-bracket" style="margin-right:4px;"></i> Login`;
  loginLink.href = "login.html";
}

const searchIcon = document.getElementById('navbarSearchIcon');
const searchDropdown = document.getElementById('navbarSearchDropdown');
let isSearchOpen = false; // default closed
searchDropdown.style.display = 'none'; // ensure hidden on load

// Toggle search dropdown on icon click
searchIcon.addEventListener('click', e => {
  e.stopPropagation();
  isSearchOpen = !isSearchOpen;
  searchDropdown.style.display = isSearchOpen ? 'block' : 'none';
  if (isSearchOpen) searchDropdown.querySelector('input').focus();
});

// Close search when clicking outside
document.addEventListener('click', e => {
  if (!searchDropdown.contains(e.target) && e.target !== searchIcon) {
    isSearchOpen = false;
    searchDropdown.style.display = 'none';
  }
});

// Close search when scrolling
window.addEventListener('scroll', () => {
  if (isSearchOpen) {
    isSearchOpen = false;
    searchDropdown.style.display = 'none';
  }
});

});

// Use requestAnimationFrame on scroll for smoother performance
window.addEventListener('scroll', updateIconsOnScroll);
window.addEventListener('resize', handleResize);

</script>

<!--------Start of Tawk.to Script------------>
<script type="text/javascript">
var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='https://embed.tawk.to/68eb2ec37fb4cc1951b88776/1j7batblb';
s1.charset='UTF-8';
s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();
</script>
<!--End of Tawk.to Script-->

</body>
</html>

