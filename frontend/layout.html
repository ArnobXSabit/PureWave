<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PureWave</title>
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Raleway:wght@600;700;900&display=swap" rel="stylesheet">
<link rel="icon" type="image/x-icon" href="favicon.png">

<style>
/* ---------- Global Styles ---------- */
* { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', Arial, sans-serif; }
body { background:#fff; color:#333; line-height:1.6; font-size:16px; padding-top:100px; }

/* ---------- Navbar ---------- */
.navbar, .duplicate-navbar {width:100%; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,0.1); position:fixed; top:0; z-index:1000;}
.nav-container {display: flex;justify-content: space-between;align-items: center;gap:16px;width:100%;padding:20px;}
.nav-left { display:flex; align-items:center; gap:16px; }
.nav-left .brand { display:flex; align-items:center; gap:8px; text-decoration:none; }
.nav-left .brand-icon { height:25px; }
.nav-left .logo { font-size:1.8rem; font-weight:bold; color:#222; font-family:'Raleway', sans-serif; }

/* Center search bar */
.nav-center { flex:1; display:flex; justify-content:center; align-items:center; position:relative; }
.nav-center input[type="text"] {width:100%;max-width:300px;padding:8px 12px;border:1px solid #ccc;border-radius:24px 0 0 24px;outline:none;}
.nav-center button {padding:8px 16px;border:none;background:#000;color:#fff;border-radius:0 24px 24px 0;cursor:pointer;transition: background 0.3s;}
.nav-center button:hover { background:#333; }

.nav-links { display:flex; gap:50px; align-items:center; }
.nav-links a { color:#222; font-size:1.4rem; transition: color 0.3s; position:relative; }
.nav-links a:hover { color:#3a91f5; }

/* Duplicate Navbar */
.duplicate-navbar { z-index:1100; transition: transform 0.3s ease, opacity 0.3s ease; }
.duplicate-navbar.hidden { transform: translateY(-100%); opacity: 0; }

/* Sidebar */
#sidebar { position: fixed; top: 100px; left: -400px; width: 400px; height: calc(100% - 100px); background:#fafafa; color:#1a1a1a; overflow-y:auto; box-shadow:3px 0 12px rgba(0,0,0,0.1); padding:20px; transition:left 0.3s ease; z-index:1200; }
#sidebar.open { left:0; }
#sidebar::-webkit-scrollbar { width:8px; }
#sidebar::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.25); border-radius:4px; }
#sidebar h2 { margin-top:0; margin-bottom:12px; font-size:1.3rem; font-weight:700; }
#sidebar ul { list-style:none; padding-left:0; margin:0; }
#sidebar ul li { margin:6px 0; }
#sidebar ul li .flex-row { display:flex; justify-content:space-between; align-items:center; }
#sidebar ul li a { text-decoration:none; color:#222; font-weight:600; transition:color 0.2s ease; }
#sidebar ul li a:hover { color:#3a91f5; }
#sidebar ul li span.toggle { cursor:pointer; font-weight:900; font-size:1.5rem; color:#000; margin-left:8px; user-select:none; }
#sidebar ul li a.grand { font-weight:700; font-size:1.1rem; }
#sidebar ul li a.parent { font-weight:600; font-size:1rem; }
#sidebar ul li a.child { font-weight:500; font-size:0.95rem; }

/* Footer */
footer { background:#222; color:#fff; padding:40px 0; text-align:center; font-size:0.9rem; }

/* Navbar Cart Count Bubble */
.nav-cart-count {position: absolute;top: -8px;right: -8px;background: #3a91f5;color: #fff;font-size: 0.75rem;font-weight: bold;width: 18px;height: 18px;border-radius: 50%;display: flex;justify-content: center;align-items: center;}

/* Floating cart */
#floatingCart {position: fixed;bottom: 30px;right: 30px;width:50px;height:50px;background:#3a91f5;color:#fff;border-radius:50%;display:flex;justify-content:center;align-items:center;font-size:1.5rem;z-index:1200;box-shadow:0 4px 20px rgba(0,0,0,0.3);}
#floatingCart span { position:absolute; top:-8px; right:-8px; width:18px; height:18px; background:#ff0000; color:#fff; font-size:0.75rem; border-radius:50%; display:flex; justify-content:center; align-items:center; font-weight:bold; }

/* Autocomplete dropdown */
#autocomplete-list {position: absolute;background: #fff;border: 1px solid #ccc;max-height: 200px;overflow-y: auto;width: 100%;top: 38px;left: 0;z-index: 9999;border-radius: 0 0 8px 8px;}
#autocomplete-list div {padding: 8px 12px;cursor: pointer;}

/* ---------- Floating Background ---------- */
#floatingBackground {position: absolute;top: 100px;left: 0;right: 0;bottom: 0;width: 100%;pointer-events: none;overflow: hidden;z-index: 0;}
.floating-icon {position: absolute;width: 60px;height: 60px;opacity: 0.1;animation: float 12s ease-in-out infinite;}

@keyframes float {
  0%   { transform: translateY(0) translateX(0) rotate(0deg); }
  25%  { transform: translateY(-20px) translateX(10px) rotate(10deg); }
  50%  { transform: translateY(20px) translateX(-10px) rotate(-10deg); }
  75%  { transform: translateY(-10px) translateX(5px) rotate(5deg); }
  100% { transform: translateY(0) translateX(0) rotate(0deg); }
}
</style>
</head>
<body>

<!-- Duplicate Navbar -->
<header class="navbar duplicate-navbar" id="duplicateNavbar">
  <div class="nav-container">
    <div class="nav-left">
      <button id="sidebarToggle2" style="background:none;border:none;font-size:1.8rem;cursor:pointer;">&#9776;</button>
      <a href="index.html" class="brand">
        <img src="icon.png" alt="Brand Icon" class="brand-icon">
        <span class="logo">PureWave</span>
      </a>
    </div>
    <div class="nav-center">
      <form id="searchForm" style="display:flex; width:100%; max-width:400px; position:relative;">
        <input type="text" id="searchInput" placeholder="Search products...">
        <button type="submit"><i class="fas fa-search"></i></button>
      </form>
    </div>
    <nav class="nav-links">
      <a href="index.html" title="Home"><i class="fas fa-home"></i></a>
      <a href="products.html" title="Shop"><i class="fas fa-store"></i></a>
      <a href="cart.html" title="Cart">
        <i class="fas fa-shopping-cart"></i>
        <span class="nav-cart-count" id="duplicateNavbarCartCount">0</span>
      </a>
      <a href="userprofile.html" title="Profile"><i class="fas fa-user"></i></a>
    </nav>
  </div>
</header>

<!-- Original Navbar -->
<header class="navbar" id="navbar">
  <div class="nav-container">
    <div class="nav-left">
      <button id="sidebarToggle" style="background:none;border:none;font-size:1.8rem;cursor:pointer;">&#9776;</button>
      <a href="index.html" class="brand">
        <img src="icon.png" alt="Brand Icon" class="brand-icon">
        <span class="logo">PureWave</span>
      </a>
    </div>
    
<nav class="nav-links">
  <a href="index.html" title="Home"><i class="fas fa-home"></i></a>
  <a href="javascript:void(0);" id="navbarSearchIcon" title="Search"><i class="fas fa-search"></i></a>
  <a href="products.html" title="Shop"><i class="fas fa-store"></i></a>
  <a href="cart.html" title="Cart">
    <i class="fas fa-shopping-cart"></i>
    <span class="nav-cart-count" id="navbarCartCount">0</span>
  </a>
  <a href="userprofile.html" title="Profile"><i class="fas fa-user"></i></a>
</nav>

<!-- Dropdown Search Bar -->
<div id="navbarSearchDropdown" style="display:none; position:absolute; top:100%; right:0; width:250px; background:#fff; border:1px solid #ccc; border-radius:8px; padding:8px; z-index:1000;">
  <form id="navbarDropdownForm" style="display:flex;">
    <input type="text" id="navbarDropdownInput" placeholder="Search products..." style="flex:1; padding:6px 8px; border:1px solid #ccc; border-radius:4px 0 0 4px; outline:none;">
    <button type="submit" style="padding:6px 10px; border:none; background:#333; color:#fff; border-radius:0 4px 4px 0; cursor:pointer;">
      <i class="fas fa-search"></i>
    </button>
  </form>
</div>

  </div>
</header>

<!-- Floating Icons Background -->
<div id="floatingBackground"></div>

<main>
  <!-- Put main contents here -->
</main>

<footer>
  &copy; 2025 PureWave. All rights reserved.
</footer>

<aside id="sidebar">
  <h2>Categories</h2>
  <ul id="sidebarCategories"></ul>
</aside>

<!-- Floating Cart -->
<a href="cart.html" id="floatingCart">
  <i class="fas fa-shopping-cart"></i>
  <span id="cartCount">0</span>
</a>

<script>
  const BACKEND_URL = "https://purewave.onrender.com"; 
</script>
<script>
let allCategories = [];

async function loadAllCategories() {
  try {
    const res = await fetch(`${BACKEND_URL}/api/categories`);
    allCategories = await res.json();
  } catch (err) { console.error(err); }
}

// Initialize
document.addEventListener("DOMContentLoaded", ()=>{
  loadAllCategories(); // important!
});
</script>
<script>
  // ------------------ Search and Dropdown search with aout complete feature ------------------
</script>

<script>

// ------------------ Sidebar Toggle ------------------
const sidebarToggle = document.getElementById('sidebarToggle');
const sidebarToggle2 = document.getElementById('sidebarToggle2');
const sidebar = document.getElementById('sidebar');
sidebarToggle.addEventListener('click', () => sidebar.classList.toggle('open'));
sidebarToggle2.addEventListener('click', () => sidebar.classList.toggle('open'));
document.addEventListener('click', e => {
  if(!sidebar.contains(e.target) && !sidebarToggle.contains(e.target) && !sidebarToggle2.contains(e.target)) sidebar.classList.remove('open');
});
function adjustSidebar() {
  const navHeight = document.querySelector('.navbar').offsetHeight;
  sidebar.style.top = navHeight + 'px';
  sidebar.style.height = `calc(100% - ${navHeight}px)`;
}
window.addEventListener('load', adjustSidebar);
window.addEventListener('resize', adjustSidebar);

// ------------------ Sidebar Categories ------------------
async function loadSidebarCategories() {
  try {
    const res = await fetch(`${BACKEND_URL}/api/categories`);
    const categories = await res.json();
    const container = document.getElementById("sidebarCategories");
    const map = {};
    categories.forEach(cat => {
      const parentId = cat.parent_id ?? 0;
      if (!map[parentId]) map[parentId] = [];
      map[parentId].push(cat);
    });

    function createList(parentId, depth = 0) {
      if (!map[parentId]) return null;
      const ul = document.createElement('ul');
      ul.style.paddingLeft = depth === 0 ? '0' : '14px';
      ul.style.margin = '6px 0';

      map[parentId].forEach(cat => {
        const li = document.createElement('li');
        const hasChildren = map[cat.category_id] && map[cat.category_id].length > 0;
        const flexRow = document.createElement('div');
        flexRow.classList.add('flex-row');

        const a = document.createElement('a');
        a.textContent = cat.category_name;
        a.href = hasChildren ? '#' : `products.html?category=${cat.category_id}`;
        a.classList.add(depth === 0 ? 'grand' : depth === 1 ? 'parent' : 'child');

        flexRow.appendChild(a);

        const childrenUl = createList(cat.category_id, depth + 1);
        if (childrenUl) {
          childrenUl.style.display = 'none';
          const toggle = document.createElement('span');
          toggle.textContent = '+';
          toggle.classList.add('toggle');

          function toggleChildren(e) {
            e.stopPropagation();
            childrenUl.style.display = childrenUl.style.display === 'block' ? 'none' : 'block';
            toggle.textContent = childrenUl.style.display === 'block' ? 'âˆ’' : '+';
          }

          toggle.addEventListener('click', toggleChildren);
          a.addEventListener('click', e => {
            if (hasChildren) {
              e.preventDefault();
              toggleChildren(e);
            }
          });

          flexRow.appendChild(toggle);
          li.appendChild(flexRow);
          li.appendChild(childrenUl);
        } else {
          li.appendChild(flexRow);
        }

        ul.appendChild(li);
      });

      return ul;
    }

    const topUl = createList(0);
    if (topUl) container.appendChild(topUl);
  } catch (err) {
    console.error(err);
  }
}

// ------------------ Cart Count ------------------
function updateCartCount() {
  let cartItems = JSON.parse(localStorage.getItem('cart')) || [];
  if (!Array.isArray(cartItems) && typeof cartItems === 'object') {
    // cart as {id: qty, ...}
    cartItems = Object.values(cartItems).reduce((sum, qty) => sum + qty, 0);
  } else {
    cartItems = cartItems.length;
  }

  document.getElementById('cartCount').textContent = cartItems;
  document.getElementById('navbarCartCount').textContent = cartItems;
  document.getElementById('duplicateNavbarCartCount').textContent = cartItems;
}

// ------------------ Duplicate navbar scroll hide ------------------
const duplicateNavbar=document.getElementById('duplicateNavbar');
let lastScroll=window.scrollY;
window.addEventListener('scroll', ()=>{
  let currentScroll=window.scrollY;
  if(currentScroll>lastScroll && currentScroll>50) duplicateNavbar.classList.add('hidden');
  else duplicateNavbar.classList.remove('hidden');
  lastScroll=currentScroll;
});

// ------------------ Initialize ------------------
document.addEventListener("DOMContentLoaded", () => {
  loadSidebarCategories();
  updateCartCount();
});
</script>

<script>
  // ------------------ Floating Background ------------------
document.addEventListener("DOMContentLoaded", () => {
  const floatingBg = document.getElementById("floatingBackground");
  const iconCount = 200;
  const iconSize = 60;
  const gap = 10;
  const cols = Math.floor(floatingBg.offsetWidth / (iconSize + gap));
  const rows = Math.floor(floatingBg.offsetHeight / (iconSize + gap));
  const positions = [];
  for (let r = 0; r < rows; r++){ for (let c = 0; c < cols; c++){ positions.push({x: c*(iconSize+gap), y: r*(iconSize+gap)}); } }
  positions.sort(() => 0.5 - Math.random());
  for(let i=0;i<Math.min(iconCount, positions.length);i++){
    const pos=positions[i]; const icon=document.createElement("img"); icon.src="w-icon.svg"; icon.classList.add("floating-icon");
    icon.style.left=pos.x+"px"; icon.style.top=pos.y+"px"; icon.style.animationDuration=(10+Math.random()*10)+"s"; icon.style.animationDelay=Math.random()*10+"s";
    floatingBg.appendChild(icon);
  }
});
</script>
</body>
</html>
