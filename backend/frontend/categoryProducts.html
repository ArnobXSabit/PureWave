<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PureWave - Category Products</title>
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="sidebar.css">
<style>
/* ---------- Product card styles ---------- */
.product-card {
  opacity: 0;
  transform: scale(0.95) translateY(30px);
  transition: transform 0.8s cubic-bezier(0.4,0,0.2,1), opacity 0.8s ease;
}

.product-card img {
  max-width: 100%;
  border-radius: 12px;
  margin-bottom: 12px;
  object-fit: cover;
  transition: transform 0.4s ease, box-shadow 0.4s ease;
}

.product-card:hover img {
  transform: scale(1.05);
  box-shadow: 0 12px 28px rgba(0,0,0,0.18);
}

.from-left { transform: translateX(-40px) scale(0.95); }
.from-right { transform: translateX(40px) scale(0.95); }
.from-bottom { transform: translateY(40px) scale(0.95); }

.show {
  opacity: 1;
  transform: scale(1) translate(0,0);
}

.product-grid {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  gap: 28px;
  margin-top: 40px;
}

.product-card h3 { font-weight: 700; font-size: 1.05rem; margin-bottom: 6px; color: #222; }
.product-card span { color: #666; font-size: 0.95rem; }

@media (max-width: 900px) { .product-card { width: 47%; } }
@media (max-width: 600px) { .product-card { width: 100%; } }

/* ---------- Navbar ---------- */
.navbar { width: 100%; background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.1); position: sticky; top:0; z-index:1000; }
.nav-container { max-width:1200px; margin:auto; padding:20px; display:flex; justify-content:space-between; align-items:center; }
.logo { font-size:1.8rem; font-weight:bold; color:#222; text-decoration:none; }
.nav-links { display:flex; gap:24px; }
.nav-links a { text-decoration:none; color:#222; font-weight:600; transition:color 0.3s ease; }
.nav-links a:hover { color:#000000; }

</style>
</head>
<body>

<header class="navbar">
  <div class="nav-container">
    <div style="display:flex; align-items:center; gap:16px;">
      <button id="sidebarToggle" style="background:none;border:none;font-size:1.8rem;cursor:pointer;">&#9776;</button>
      <a href="index.html" class="logo">PureWave</a>
    </div>
    <nav class="nav-links">
      <a href="index.html">Home</a>
      <a href="allProducts.html">Shop</a>
      <a href="cart.html">Cart</a>
      <span id="authLinks"></span>
    </nav>
  </div>
</header>

<section class="products">
  <div class="container" style="max-width:1200px; margin:auto; padding:40px 20px;">
    <h2 style="font-size:2rem;font-weight:900;margin-bottom:30px;border-left:6px solid #222;padding-left:16px;">Category Products</h2>
    <div id="product-grid" class="product-grid"></div>
  </div>
</section>

<script>

// ---------- User auth links ----------
const authLinks = document.getElementById("authLinks");
const user = JSON.parse(localStorage.getItem("user"));
const defaultProfile = "pp.jpg";
if(user && user.name){
  const profileImage = user.image ? user.image : defaultProfile;
  authLinks.innerHTML = `<a href="userprofile.html" style="text-decoration:none;color:#222;font-weight:600;">
    <img src="${profileImage}" alt="Profile" style="width:32px;height:32px;border-radius:50%;vertical-align:middle;">${user.name.split(" ")[0]}</a>`;
} else {
  authLinks.innerHTML = `<a href="login.html" style="text-decoration:none;color:#222;font-weight:600;">Login</a>`;
}

// ---------- Get category ID from URL ----------
function getCategoryIdFromURL() {
  const params = new URLSearchParams(window.location.search);
  return params.get("category");
}

// ---------- Load products by category ----------
async function loadProducts() {
  try {
    const categoryId = getCategoryIdFromURL();
    if (!categoryId) return; // no category, exit

    const res = await fetch(`http://localhost:3000/api/products?category_id=${categoryId}`);

    const data = await res.json();
    if (!data.success) return console.error("Failed to fetch products");

    const productGrid = document.getElementById("product-grid");
    productGrid.innerHTML = "";

    const addedProducts = new Set();
    let displayIndex = 0;

    data.products.forEach(product => {
      // Ensure uniqueness by product_id
      if (addedProducts.has(product.product_id)) return;
      addedProducts.add(product.product_id);

      const card = document.createElement("div");
      card.classList.add("product-card");

      // Scroll animation classes
      if(displayIndex % 3 === 0) card.classList.add("from-left");
      else if(displayIndex % 3 === 1) card.classList.add("from-bottom");
      else card.classList.add("from-right");

      // Use first image or default
    const imageUrl = product.images.length > 0 
        ? product.images[0] 
        : 'http://localhost:3000/Products/default.jpg';

    card.innerHTML = `
      <a href="viewProduct.html?id=${product.product_id}" style="display:block;">
        <img src="${imageUrl}" alt="${product.name}" />
      </a>
      <h3>${product.name}</h3>
      <span>à§³ ${product.price}</span>
    `;

      productGrid.appendChild(card);
      displayIndex++;
    });

    // ---------- Scroll animation ----------
    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if(entry.isIntersecting) entry.target.classList.add("show");
        else entry.target.classList.remove("show");
      });
    }, { threshold: 0.15 });

    document.querySelectorAll(".product-card").forEach(card => observer.observe(card));

  } catch(err) {
    console.error("Error loading products:", err);
  }
}

document.addEventListener("DOMContentLoaded", loadProducts);
</script>

  <script src="sidebar.js"></script>

</body>
</html>
