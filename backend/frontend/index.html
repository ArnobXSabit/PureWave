<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PureWave</title>
<link rel="stylesheet" href="style.css">
<style>
/* ---------- Category card styles ---------- */
.category-card {
  background: #fff;
  width: 30%;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 18px rgba(0,0,0,0.08);
  cursor: pointer;
  display: flex;
  flex-direction: column;
  align-items: center;
  opacity: 0;
  transform: scale(0.95) translateY(30px);
  transition: transform 0.8s cubic-bezier(0.4,0,0.2,1), opacity 0.8s ease, box-shadow 0.3s ease;
}
.category-card img {
  width: 100%;
  border-radius: 12px;
  margin-bottom: 12px;
  object-fit: cover;
  transition: transform 0.4s ease, box-shadow 0.4s ease;
}
.category-card:hover {
  transform: scale(1) translateY(-4px);
  box-shadow: 0 12px 28px rgba(0,0,0,0.18);
  z-index: 2;
}
.category-card:hover img {
  transform: scale(1.05);
  box-shadow: 0 12px 28px rgba(0,0,0,0.18);
  z-index: 3;
}
.category-card h3 {
  font-weight: 700;
  color:#222;
  margin:6px 0 4px 0;
  font-size:1.05rem;
}
.category-card span {
  color:#666;
  font-size:0.95rem;
  margin-top: 2px;
}

/* Scroll animation */
.from-left { transform: translateX(-40px) scale(0.95); }
.from-right { transform: translateX(40px) scale(0.95); }
.from-bottom { transform: translateY(40px) scale(0.95); }
.show {
  opacity: 1;
  transform: scale(1) translate(0,0);
  transition: transform 0.8s cubic-bezier(0.4,0,0.2,1), opacity 0.8s ease;
}

/* Grid layout */
.category-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 28px;
  margin-top: 40px;
}

/* Responsive */
@media(max-width:900px){ .category-card{ width:47%; } }
@media(max-width:600px){ .category-card{ width:100%; } }

/* Navbar & hero */
.navbar { width:100%; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,0.1); position:fixed; top:0; z-index:1000; }
.nav-container { max-width:1200px; margin:auto; padding:20px; display:flex; justify-content:space-between; align-items:center; }
.logo { font-size:1.8rem; font-weight:bold; color:#222; text-decoration:none; }
.nav-links { display:flex; gap:24px; }
.nav-links a { text-decoration:none; color:#222; font-weight:600; }
.nav-links a:hover { color:#000000; }

/* Sidebar */
#sidebar {
  top: 122px;
  font-family: 'Helvetica Neue', 'Segoe UI', 'Roboto', sans-serif;
  background: #fafafa;
  color: #1a1a1a;
  position: fixed;
  left: -400px;
  width: 400px;
  height: 100%;
  overflow-y: auto;
  box-shadow: 3px 0 12px rgba(0,0,0,0.1);
  padding: 20px;
  transition: left 0.3s ease;
  z-index: 1200;
}
#sidebar.open { left: 0; }
#sidebar::-webkit-scrollbar { width: 8px; }
#sidebar::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.25); border-radius: 4px; }
#sidebar h2 { margin-top: 0; margin-bottom: 12px; font-size: 1.3rem; font-weight: 700; }
#sidebar ul { list-style:none; padding-left:0; margin:0; }
#sidebar ul li { margin:6px 0; }
#sidebar ul li .flex-row { display:flex; justify-content:space-between; align-items:center; }
#sidebar ul li a { text-decoration:none; color:#222; font-weight:600; transition: color 0.2s ease; }
#sidebar ul li a:hover { color:#3a91f5; }
#sidebar ul li span.toggle {cursor: pointer;font-weight: 900;font-size: 1.5rem;color: #000000;margin-left: 8px;user-select: none;}

/* Category level styles */
#sidebar ul li a.grand { font-weight:700; color:#1a1a1a; font-size:1.1rem; }
#sidebar ul li a.parent { font-weight:600; color:#222; font-size:1rem; }
#sidebar ul li a.child { font-weight:500; color:#555; font-size:0.95rem; }

/* Buttons */
.btn {
  display: inline-block;
  background: linear-gradient(135deg, #222, #3a91f5);
  color: #fff;
  padding: 16px 48px;
  border-radius: 40px;
  font-size: 1.1rem;
  font-weight: 600;
  text-decoration: none;
  box-shadow: 0 8px 28px rgba(58, 145, 245, 0.4);
  transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
  cursor: pointer;
  width: fit-content;
}
.btn:hover,
.btn:focus {
  background: linear-gradient(135deg, #3a91f5, #222);
  box-shadow: 0 12px 36px rgba(58,145,245,0.6);
  transform: scale(1.05);
  outline: none;
}
</style>
</head>
<body>

<header class="navbar">
  <div class="nav-container">
    <div style="display:flex; align-items:center; gap:16px;">
      <button id="sidebarToggle" style="background:none;border:none;font-size:1.8rem;cursor:pointer;">&#9776;</button>
      <a href="index.html" class="logo">PureWave</a>
    </div>
    <nav class="nav-links">
      <a href="index.html">Home</a>
      <a href="allProducts.html">Shop</a>
      <a href="cart.html">Cart</a>
      <span id="authLinks"></span>
    </nav>
  </div>
</header>

<!-- Hero Section -->
<section class="hero" style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding:60px 0 80px; text-align:center; position:relative;">
  <div class="hero-content" style="max-width:600px; margin:0 auto; color:#222; background:#fff; border-radius:22px; box-shadow:0 8px 32px rgba(34,34,34,0.1); border:1.5px solid #e3e6ee; padding:38px 32px 36px;">
    <h2 style="font-size:2.8rem; font-weight:700; margin-bottom:10px; letter-spacing:1px; background:linear-gradient(90deg,#222 60%,#c3cfe2 100%); -webkit-background-clip:text; -webkit-text-fill-color:transparent; display:inline-block;">Premium Clothing</h2>
    <div style="width:60px; height:4px; background:linear-gradient(90deg,#222 60%,#c3cfe2 100%); border-radius:2px; margin:0 auto 18px;"></div>
    <p style="font-size:1.25rem; margin-bottom:32px; color:#444;">Shop the latest designs in comfort and style.</p>
    <a href="allProducts.html" class="btn">Shop Now</a>
  </div>
  <svg style="position:absolute; bottom:-1px; left:0; width:100%; height:60px;" viewBox="0 0 1440 60" fill="none">
    <path fill="#fff" d="M0,0 C480,60 960,0 1440,60 L1440,60 L0,60 Z"></path>
  </svg>
</section>

<!-- Featured Categories -->
<section class="products">
  <div class="container" style="max-width:1200px; margin:auto; padding:40px 20px;">
    <h2 style="font-size:2.2rem; font-weight:900; color:#181818; margin-bottom:48px; border-left:6px solid #222; padding-left:18px;">Featured Categories</h2>
    <div id="categoriesGrid" class="category-grid"></div>
  </div>
</section>

<footer style="background:#222; color:#fff; padding:40px 0; text-align:center;">
  <p style="margin:0; font-size:0.9rem;">&copy; 2025 PureWave. All rights reserved.</p>
</footer>

<aside id="sidebar">
  <h2>Categories</h2>
  <ul id="sidebarCategories"></ul>
</aside>

<script>
// User auth links
const authLinks = document.getElementById("authLinks");
const user = JSON.parse(localStorage.getItem("user"));
const defaultProfile = "pp.jpg";
if(user && user.name){
  const profileImage = user.image ? user.image : defaultProfile;
  authLinks.innerHTML = `<a href="userprofile.html" style="text-decoration:none;color:#222;font-weight:600;">
    <img src="${profileImage}" alt="Profile" style="width:32px;height:32px;border-radius:50%;vertical-align:middle;">${user.name.split(" ")[0]}</a>`;
} else {
  authLinks.innerHTML = `<a href="login.html" style="text-decoration:none;color:#222;font-weight:600;">Login</a>`;
}

// Sidebar toggle
const sidebarToggle = document.getElementById('sidebarToggle');
const sidebar = document.getElementById('sidebar');
sidebarToggle.addEventListener('click', () => { sidebar.classList.toggle('open'); });
document.addEventListener('click', e => {
  if(!sidebar.contains(e.target) && !sidebarToggle.contains(e.target)){
    sidebar.classList.remove('open');
  }
});

// Load categories
async function loadCategories(){
  try{
    const res = await fetch("http://localhost:3000/api/categories");
    const categories = await res.json();
    const container = document.getElementById("categoriesGrid");

    const categoriesWithImages = categories
      .filter(cat=>cat.thumbnail && cat.thumbnail.url)
      .sort((a,b)=> (a.thumbnail_order ?? a.category_id) - (b.thumbnail_order ?? b.category_id));

    container.innerHTML = "";
    categoriesWithImages.forEach((cat,index)=>{
      const card = document.createElement("div");
      card.classList.add("category-card");
      if(index % 3 === 0) card.classList.add("from-left");
      else if(index % 3 === 1) card.classList.add("from-bottom");
      else card.classList.add("from-right");

      card.innerHTML = `
        <a href="categoryProducts.html?category=${cat.category_id}" style="text-decoration:none;color:inherit;">
          <img src="${cat.thumbnail.url}" alt="${cat.category_name}" />
          <h3>${cat.category_name}</h3>
          ${cat.parent_name ? `<span>${cat.parent_name}</span>` : ""}
        </a>
      `;
      container.appendChild(card);
    });

    const observer = new IntersectionObserver(entries=>{
      entries.forEach(entry=>{
        if(entry.isIntersecting) entry.target.classList.add("show");
        else entry.target.classList.remove("show");
      });
    }, {threshold:0.15});
    document.querySelectorAll(".category-card").forEach(card=>observer.observe(card));

  } catch(err){ console.error("Error loading categories:", err);}
}

// Load sidebar categories
async function loadSidebarCategories() {
  try {
    const res = await fetch("http://localhost:3000/api/categories");
    const categories = await res.json();
    const container = document.getElementById("sidebarCategories");

    const map = {};
    categories.forEach(cat => {
      const parentId = cat.parent_id ?? 0;
      if (!map[parentId]) map[parentId] = [];
      map[parentId].push(cat);
    });

    function createList(parentId, depth=0) {
      if (!map[parentId]) return null;
      const ul = document.createElement('ul');
      ul.style.paddingLeft = depth === 0 ? '0' : '14px';
      ul.style.margin = '6px 0';

      map[parentId].forEach(cat => {
        const li = document.createElement('li');

        const hasChildren = map[cat.category_id] && map[cat.category_id].length > 0;

        const flexRow = document.createElement('div');
        flexRow.classList.add('flex-row');

        const a = document.createElement('a');
        a.textContent = cat.category_name;
        if (!hasChildren) a.href = `categoryProducts.html?category=${cat.category_id}`;
        else a.href = "#"; // dummy href for parent with children

        if(depth===0) a.classList.add('grand');
        else if(depth===1) a.classList.add('parent');
        else a.classList.add('child');

        flexRow.appendChild(a);

        const childrenUl = createList(cat.category_id, depth+1);
        if (childrenUl) {
          childrenUl.style.display = 'none';

          const toggle = document.createElement('span');
          toggle.textContent = '+';
          toggle.classList.add('toggle');

          // Toggle children when clicking parent row or + sign
          function toggleChildren(e) {
            e.stopPropagation();
            childrenUl.style.display = childrenUl.style.display === 'block' ? 'none' : 'block';
            toggle.textContent = childrenUl.style.display === 'block' ? '−' : '+';
          }

          toggle.addEventListener('click', toggleChildren);

          // Clicking the parent `<a>` also toggles children
          a.addEventListener('click', e => {
            if(hasChildren){
              e.preventDefault(); // prevent navigation
              toggleChildren(e);
            }
          });

          flexRow.appendChild(toggle);
          li.appendChild(flexRow);
          li.appendChild(childrenUl);
        } else {
          li.appendChild(flexRow);
        }

        ul.appendChild(li);
      });

      return ul;
    }

    const topUl = createList(0);
    if(topUl) container.appendChild(topUl);

  } catch(err){
    console.error("Error loading sidebar categories:", err);
  }
}


// Initialize both
document.addEventListener("DOMContentLoaded", ()=>{
  loadCategories();
  loadSidebarCategories();
});
</script>
<!-- ----------sidebar Script over-------- -->

</body>
</html>
