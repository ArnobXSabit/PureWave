<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Profile - PureWave</title>
<link rel="stylesheet" href="style.css">
<style>
/* ===== General Body ===== */
body {
  margin: 0;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
}

/* ===== Navbar ===== */
.navbar {
  width: 100%;
  background: #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  position: sticky;
  top: 0;
  z-index: 1000;
  padding: 16px 40px;
}
.nav-container { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: auto; }
.logo { font-size: 1.8rem; font-weight: bold; color: #222; cursor: pointer; }
.logo:hover { color: orange; }
.nav-links { display: flex; gap: 24px; }
.nav-links a, .nav-links button { text-decoration: none; color: #222; font-weight: 600; background:none; border:none; cursor:pointer; font-size:1rem; }
.nav-links a:hover, .nav-links button:hover { color: #3a91f5; }

/* ===== Profile Layout ===== */
.profile-container {
  max-width: 1000px;
  margin: 120px auto 40px auto;
  display: grid;
  grid-template-columns: 1fr 2fr;
  gap: 32px;
  background: #fff;
  border-radius: 22px;
  box-shadow: 0 8px 32px rgba(34,34,34,0.10);
  border: 1.5px solid #e3e6ee;
  padding: 32px;
}

/* Left Column */
.profile-left { text-align: center; }
.profile-left img { width: 140px; height: 140px; border-radius: 50%; object-fit: cover; margin-bottom: 16px; box-shadow:0 4px 16px rgba(0,0,0,0.1); cursor:pointer; }
.profile-left h2 { margin: 0 0 8px 0; font-weight: 800; font-size: 2rem; color: #222; }
.profile-left p { margin: 4px 0; color: #555; font-weight: 500; }
.logout-btn { margin-top: 16px; display: inline-block; background: linear-gradient(135deg, #222, #3a91f5); color: #fff; padding: 12px 32px; border-radius: 40px; font-weight:600; cursor:pointer; border:none; transition: all 0.3s ease; }
.logout-btn:hover { background: linear-gradient(135deg, #3a91f5, #222); transform: scale(1.05); }

/* Right Column Tabs */
.profile-right { display: flex; flex-direction: column; gap: 24px; }
.tabs { display: flex; gap: 16px; border-bottom: 2px solid #eee; }
.tab { padding: 8px 16px; cursor: pointer; font-weight: 600; transition: all 0.2s ease; }
.tab.active { border-bottom: 3px solid #3a91f5; color:#3a91f5; }

/* Tab Content */
.tab-content { display: none; animation: fadeIn 0.3s ease; }
.tab-content.active { display: block; }

/* Editable Profile Info */
.profile-info input { width: 100%; padding: 6px 12px; margin: 4px 0; border: 1px solid #ccc; border-radius: 6px; font-size:1rem; }
.save-btn { margin-top:12px; padding:10px 24px; border:none; border-radius:30px; background: linear-gradient(135deg, #222, #3a91f5); color:#fff; cursor:pointer; font-weight:600; transition: all 0.3s ease;}
.save-btn:hover { background: linear-gradient(135deg, #3a91f5, #222); transform: scale(1.05); }

/* Tables */
table { width: 100%; border-collapse: collapse; margin-top:8px; }
th, td { border:1px solid #ddd; padding:8px; text-align:left; }
th { background:#f5f5f5; }
.table-btn { padding: 6px 12px; border:none; border-radius:24px; cursor:pointer; font-weight:600; font-size:0.85rem; transition:all 0.2s ease; }
.edit-btn { background: #3a91f5; color:#fff; }
.edit-btn:hover { background:#222; }
.delete-btn { background:#ff4d4f; color:#fff; }
.delete-btn:hover { background:#c41d1d; }

/* Toast */
.toast { position: fixed; top:20px; left:50%; transform: translateX(-50%) translateY(-20px); min-width:280px; background:#3a91f5; color:#fff; padding:16px 24px; border-radius:12px; font-weight:600; box-shadow:0 8px 16px rgba(0,0,0,0.2); opacity:0; pointer-events:none; transition: all 0.5s ease; z-index:2000; text-align:center; }
.toast.show { opacity:1; pointer-events:auto; transform: translateX(-50%) translateY(0); }

@keyframes fadeIn { from {opacity:0;} to {opacity:1;} }

@media(max-width:900px){ .profile-container { grid-template-columns:1fr; margin-top:80px; } }
</style>
</head>
<body>

<header class="navbar">
  <div class="nav-container">
    <a href="index.html" class="logo">PureWave</a>
    <nav class="nav-links">
      <a href="index.html">Home</a>
      <a href="shopNow.html">Shop</a>
      <a href="cart.html">Cart</a>
      <button class="logout-btn" id="logoutBtn">Logout</button>
    </nav>
  </div>
</header>

<div class="profile-container">
  <!-- Left -->
  <div class="profile-left">
    <img src="pp.jpg" alt="Profile Picture" id="profileImage">
    <h2 id="profileName">User Name</h2>
    <p id="profileEmail">user@example.com</p>
    <p id="profileRole">Customer</p>
    <button class="logout-btn" id="logoutBtn2">Logout</button>
  </div>

  <!-- Right -->
  <div class="profile-right">
    <div class="tabs">
      <div class="tab active" data-tab="info">Profile Info</div>
      <div class="tab" data-tab="addresses">Addresses</div>
      <div class="tab" data-tab="orders">Orders</div>
      <div class="tab" data-tab="wishlist">Wishlist</div>
      <div class="tab" data-tab="loyalty">Loyalty Points</div>
    </div>

    <!-- Profile Info -->
    <div class="tab-content active" id="info">
      <div class="profile-info">
        <label>Name:</label>
        <input type="text" id="infoName">
        <label>Email:</label>
        <input type="email" id="infoEmail">
        <label>Phone:</label>
        <input type="text" id="infoPhone">
        <button class="save-btn" id="saveProfileBtn">Save Changes</button>
      </div>
    </div>

    <!-- Addresses -->
    <div class="tab-content" id="addresses">
      <table>
        <thead><tr><th>Street</th><th>City</th><th>State</th><th>Country</th><th>Postal</th></tr></thead>
        <tbody id="addressesBody"></tbody>
      </table>
    </div>

    <!-- Orders -->
    <div class="tab-content" id="orders">
      <table>
        <thead><tr><th>Order ID</th><th>Date</th><th>Status</th><th>Total</th></tr></thead>
        <tbody id="ordersBody"></tbody>
      </table>
    </div>

    <!-- Wishlist -->
    <div class="tab-content" id="wishlist">
      <table>
        <thead><tr><th>Product</th><th>Price</th><th>Action</th></tr></thead>
        <tbody id="wishlistBody"></tbody>
      </table>
    </div>

    <!-- Loyalty -->
    <div class="tab-content" id="loyalty">
      <p><strong>Total Points:</strong> <span id="loyaltyPoints">0</span></p>
    </div>
  </div>
</div>

<div id="toast" class="toast"></div>

<script>
const toast = document.getElementById("toast");
function showToast(msg,duration=2500){ toast.textContent=msg; toast.classList.add("show"); setTimeout(()=>toast.classList.remove("show"),duration); }

// Tabs
document.querySelectorAll(".tab").forEach(tab=>{
  tab.addEventListener("click",()=>{
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    tab.classList.add("active");
    document.querySelectorAll(".tab-content").forEach(c=>c.classList.remove("active"));
    document.getElementById(tab.dataset.tab).classList.add("active");
  });
});

// Load user data
let user = JSON.parse(localStorage.getItem("user"));
if(!user){ showToast("Please login first!"); setTimeout(()=>window.location.href="login.html",2500); }
else{
  document.getElementById("profileName").textContent=user.name;
  document.getElementById("profileEmail").textContent=user.email;
  document.getElementById("profileRole").textContent=user.role||"Customer";
  if(user.image) document.getElementById("profileImage").src=user.image;

  document.getElementById("infoName").value=user.name;
  document.getElementById("infoEmail").value=user.email;
  document.getElementById("infoPhone").value=user.phone||"";

  // Fetch addresses
  fetch(`http://localhost:3000/api/addresses`,{ headers:{"Authorization":`Bearer ${localStorage.getItem("accessToken")}`} })
    .then(r=>r.json()).then(data=>{
      const tbody=document.getElementById("addressesBody"); tbody.innerHTML="";
      data.addresses?.forEach(a=>{
        const tr=document.createElement("tr");
        tr.innerHTML=`<td>${a.street}</td><td>${a.city}</td><td>${a.state}</td><td>${a.country}</td><td>${a.postal_code}</td>`;
        tbody.appendChild(tr);
      });
    });

  // Orders
  fetch(`http://localhost:3000/api/orders`,{ headers:{"Authorization":`Bearer ${localStorage.getItem("accessToken")}`} })
    .then(r=>r.json()).then(data=>{
      const tbody=document.getElementById("ordersBody"); tbody.innerHTML="";
      data.orders?.forEach(o=>{
        const tr=document.createElement("tr");
        tr.innerHTML=`<td>${o.order_id}</td><td>${new Date(o.order_date).toLocaleDateString()}</td><td>${o.status}</td><td>৳ ${o.total_amount}</td>`;
        tbody.appendChild(tr);
      });
    });

  // Wishlist
  fetch(`http://localhost:3000/api/wishlist`,{ headers:{"Authorization":`Bearer ${localStorage.getItem("accessToken")}`} })
    .then(r=>r.json()).then(data=>{
      const tbody=document.getElementById("wishlistBody"); tbody.innerHTML="";
      data.wishlist?.forEach(w=>{
        const tr=document.createElement("tr");
        tr.innerHTML=`<td>${w.product_name}</td><td>৳ ${w.price}</td><td><button class="table-btn delete-btn" onclick="removeWishlist(${w.product_id})">Remove</button></td>`;
        tbody.appendChild(tr);
      });
    });

  // Loyalty
  fetch(`http://localhost:3000/api/loyalty`,{ headers:{"Authorization":`Bearer ${localStorage.getItem("accessToken")}`} })
    .then(r=>r.json()).then(data=>{
      document.getElementById("loyaltyPoints").textContent=data.points||0;
    });
}

// Logout
document.querySelectorAll("#logoutBtn,#logoutBtn2").forEach(btn=>{
  btn.addEventListener("click",()=>{
    localStorage.removeItem("user");
    localStorage.removeItem("accessToken");
    showToast("Logged out successfully!",2000);
    setTimeout(()=>window.location.href="login.html",2000);
  });
});

// Save profile changes
document.getElementById("saveProfileBtn").addEventListener("click",()=>{
  const updated={ name:document.getElementById("infoName").value, email:document.getElementById("infoEmail").value, phone:document.getElementById("infoPhone").value };
  fetch(`http://localhost:3000/api/users/${user.user_id}`,{
    method:"PUT",
    headers:{ "Content-Type":"application/json","Authorization":`Bearer ${localStorage.getItem("accessToken")}` },
    body: JSON.stringify(updated)
  }).then(r=>r.json()).then(data=>{
    if(data.success){
      showToast("Profile updated successfully!");
      user={...user,...updated};
      localStorage.setItem("user",JSON.stringify(user));
      document.getElementById("profileName").textContent=user.name;
      document.getElementById("profileEmail").textContent=user.email;
    } else showToast(data.message || "Failed to update");
  }).catch(()=>showToast("Failed to update"));
});

// Remove wishlist
function removeWishlist(productId){
  fetch(`http://localhost:3000/api/wishlist/${productId}`,{ method:"DELETE", headers:{"Authorization":`Bearer ${localStorage.getItem("accessToken")}`} })
    .then(r=>r.json()).then(data=>{
      showToast(data.message || "Removed!");
      setTimeout(()=>window.location.reload(),1000);
    });
}
</script>
</body>
</html>
